<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>üçà Melon Clicker Final</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  body{margin:0;background:linear-gradient(135deg,#74b9ff,#0984e3,#00b894);color:#fff;font-family:system-ui;text-align:center;height:100vh;overflow:hidden;position:relative;}
  body.shake{animation:shake .6s}@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-16px)}75%{transform:translateX(16px)}}
  h1{font-size:3.2em;margin:20px 0;text-shadow:0 0 25px #fff}
  .timer{font-size:5em;font-weight:900;background:rgba(0,0,0,.3);padding:12px 35px;border-radius:30px;display:inline-block;text-shadow:0 0 30px #ffeb3b;}
  .info{font-size:1.8em;margin:20px;background:rgba(255,255,255,.2);padding:18px;border-radius:25px;backdrop-filter:blur(15px);}
  #area{position:relative;height:56vh;background:rgba(255,255,255,.15);border-radius:30px;overflow:hidden;margin:20px 10px;backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.3);}
  .melon,.bomb,.ice{position:absolute;cursor:pointer;user-select:none;font-size:70px;filter:drop-shadow(0 0 15px rgba(255,255,255,0.8));animation:fall linear forwards;}
  .ice{font-size:50px;filter:drop-shadow(0 0 20px rgba(135,206,255,1));}
  @keyframes fall{from{top:-110px;transform:rotate(0)scale(.7)}50%{transform:rotate(360deg)scale(1)}to{top:100vh;transform:rotate(720deg)scale(1.1)}}
  .boom{position:absolute;font-size:190px;pointer-events:none;animation:boom .9s forwards;z-index:99;}
  @keyframes boom{0%{transform:scale(0) rotate(0);opacity:1}100%{transform:scale(6.5) rotate(180deg);opacity:0}}
  .pop{font-size:55px;font-weight:bold;pointer-events:none;animation:p .7s forwards;position:absolute;z-index:100;}
  .pop-melon{color:#00ff88;text-shadow:0 0 25px #00ff88}
  .pop-bomb{color:#ff4757;text-shadow:0 0 25px #ff4757}
  @keyframes p{0%{transform:scale(0)}60%{transform:scale(1.6)translateY(-50px)}100%{transform:translateY(-160px);opacity:0}}
  button{margin:10px;padding:16px 42px;font-size:21px;background:rgba(255,255,255,0.95);color:#2d3436;border:none;border-radius:30px;font-weight:600;box-shadow:0 10px 30px rgba(0,0,0,0.3);transition:all 0.3s;}
  button:hover{transform:translateY(-3px);box-shadow:0 15px 40px rgba(0,0,0,0.4);}
  .paused{animation-play-state:paused!important;filter:brightness(0.7) saturate(0.8) drop-shadow(0 0 10px rgba(135,206,255,0.8));}
</style>
</head>
<body>
<h1>üçà Melon Clicker</h1>
<div class="timer" id="timer">30</div>
<div class="info">
  Round: <span id="score">0</span> üçà | Total: <span id="total">0</span> üçà<br>
  Plays: <span id="plays">3</span>/3
</div>
<div id="area"></div>
<button onclick="mine()">‚õèÔ∏è Daily Mine</button>
<button onclick="about()">‚ÑπÔ∏è About</button>

<script>
const tg = window.Telegram?.WebApp || {HapticFeedback:{impactOccurred(){}},sendData(){},close(){location.reload();}};
tg.ready(); tg.expand();

let timeLeft = 30, score = 0, total = parseInt(localStorage.getItem('totalScore')||'0'), plays = 3;
let isFreezing = false;
const today = new Date().toDateString();
if(localStorage.getItem('today') !== today){ 
  localStorage.setItem('today',today); 
  localStorage.setItem('playsLeft',3); 
  localStorage.setItem('mined','no'); 
  plays=3; 
}
else plays = parseInt(localStorage.getItem('playsLeft')||'3');
document.getElementById('total').textContent = total;
document.getElementById('plays').textContent = plays;

// Timer
const timerInt = setInterval(()=>{
  if(timeLeft > 0){
    timeLeft--;
    document.getElementById('timer').textContent = timeLeft;
    if(timeLeft <= 5) document.getElementById('timer').style.textShadow = '0 0 30px #ff4757';
  } else {
    clearInterval(timerInt);
    endSession();
  }
},1000);

// Spawn ~300 fruits total
setInterval(()=>{
  if(timeLeft<=0 || plays<=0 || isFreezing) return;
  const count = timeLeft > 15 ? 2 : 1;
  for(let i=0; i<count; i++){
    const r = Math.random();
    if(r < 0.78) spawnMelon();
    else if(r < 0.94) spawnBomb();
    else spawnIce();
  }
}, 390);

// SPAWN FUNCTIONS
function spawnMelon(){
  const el = document.createElement('div');
  el.textContent = 'üçà';
  el.className = 'melon';
  el.style.left = (Math.random()*82 + 8) + '%';
  el.style.animationDuration = (3.1 + Math.random()*1.2) + 's';
  el.onclick = (e) => {
    score += 10;
    tg.HapticFeedback.impactOccurred('light');
    popText('+10 üçà', e.clientX || e.touches[0].clientX, e.clientY || e.touches[0].clientY, false);
    updateScore();
    el.remove();
  };
  document.getElementById('area').appendChild(el);
  setTimeout(()=> {if(el.parentNode) el.remove();}, 5500);
}

function spawnBomb(){
  const el = document.createElement('div');
  el.textContent = 'üí£';
  el.className = 'bomb';
  el.style.left = (Math.random()*82 + 8) + '%';
  el.style.animationDuration = (3.1 + Math.random()*1.2) + 's';
  el.onclick = (e) => {
    score = Math.max(0, score - 5);
    tg.HapticFeedback.impactOccurred('heavy');
    document.body.classList.add('shake');
    setTimeout(()=>document.body.classList.remove('shake'), 600);
    bigBoom(e.clientX || e.touches[0].clientX, e.clientY || e.touches[0].clientY);
    popText('-5', e.clientX || e.touches[0].clientX, e.clientY || e.touches[0].clientY, true);
    updateScore();
    el.remove();
  };
  document.getElementById('area').appendChild(el);
  setTimeout(()=> {if(el.parentNode) el.remove();}, 5500);
}

function spawnIce(){
  const el = document.createElement('div');
  el.textContent = '‚ùÑÔ∏è';
  el.className = 'ice';
  el.style.left = (Math.random()*84 + 7) + '%';
  el.style.animationDuration = (3.4 + Math.random()*0.9) + 's';
  el.onclick = () => {
    triggerFreeze();
    tg.HapticFeedback.impactOccurred('medium');
    el.remove();
  };
  document.getElementById('area').appendChild(el);
  setTimeout(()=> {if(el.parentNode) el.remove();}, 5500);
}

// FREEZE 3 SECONDS - ONLY FRUITS PAUSE
function triggerFreeze(){
  if(isFreezing) return;
  isFreezing = true;
  document.querySelectorAll('#area .melon, #area .bomb').forEach(el => el.classList.add('paused'));
  setTimeout(()=>{
    document.querySelectorAll('#area .melon, #area .bomb').forEach(el => el.classList.remove('paused'));
    isFreezing = false;
  }, 3000); // 3 SECONDS FREEZE
}

// HELPERS
function updateScore(){ document.getElementById('score').textContent = score; }
function popText(text, x, y, isBomb){
  const p = document.createElement('div');
  p.textContent = text;
  p.className = `pop ${isBomb ? 'pop-bomb' : 'pop-melon'}`;
  p.style.left = (x - 35) + 'px';
  p.style.top = (y - 90) + 'px';
  document.body.appendChild(p);
  setTimeout(()=>p.remove(), 700);
}
function bigBoom(x, y){
  const b = document.createElement('div');
  b.textContent = 'üí•';
  b.className = 'boom';
  b.style.left = (x - 95) + 'px';
  b.style.top = (y - 95) + 'px';
  document.body.appendChild(b);
  setTimeout(()=>b.remove(), 900);
}

function endSession(){
  total += score;
  localStorage.setItem('totalScore', total);
  plays--;
  localStorage.setItem('playsLeft', plays);
  document.getElementById('total').textContent = total;
  document.getElementById('plays').textContent = plays;
  tg.sendData(JSON.stringify({score: score, total: total}));
  if(plays > 0){
    alert(`‚è∞ Time Up!\nRound: +${score} üçà\nTotal: ${total} üçà\nPlays left: ${plays}`);
    location.reload();
  } else {
    document.getElementById('area').innerHTML = `<h2 style="margin-top:140px;font-size:2em;">üéâ All 3 plays done!<br>Total: ${total} üçà<br>Come back tomorrow!</h2>`;
    document.getElementById('timer').textContent = 'DONE';
    alert(`üéâ All done!\nLast round: ${score} üçà\nTotal: ${total} üçà\nTomorrow again!`);
    setTimeout(()=>tg.close(), 5000);
  }
}

function mine(){
  if(localStorage.getItem('mined') === today) return alert('‚õèÔ∏è Already mined today!');
  const reward = Math.floor(Math.random() * 600) + 300;
  total += reward;
  localStorage.setItem('totalScore', total);
  localStorage.setItem('mined', today);
  document.getElementById('total').textContent = total;
  alert(`‚õèÔ∏è Mined +${reward} üçà!\nTotal now: ${total} üçà`);
}

function about(){
  alert("üçà Melon Clicker PRO\n\nüí£ Boom click = -5\nüçà Melon click = +10\n‚ùÑÔ∏è Ice click = 3s FREEZE (only fruits pause)\n\n~300 fruits/30s | 3 plays/day\nZero lag + full effects!");
}
</script>
</body>
</html>