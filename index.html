<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ğŸˆ Rodent Royale - Telegram Mini Game</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<script type="module">
// import à¦®à¦¡à¦¿à¦‰à¦² à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¨: push à¦à¦° à¦¬à¦¦à¦²à§‡ set à¦¯à§à¦•à§à¦¤ à¦•à¦°à¦¾ à¦¹à§Ÿà§‡à¦›à§‡
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getDatabase, ref, set, onValue, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

const firebaseConfig = {
Â  apiKey: "AIzaSyB9VtW1YpDfM9UynxFQvv9-OSRtf-U7Z_k",
Â  authDomain: "redent-royal.firebaseapp.com",
Â  databaseURL: "https://redent-royal-default-rtdb.firebaseio.com",
Â  projectId: "redent-royal",
Â  storageBucket: "redent-royal.firebasestorage.app",
Â  messagingSenderId: "683092186570",
Â  appId: "1:683092186570:web:aa3985c9c7f07bc38eeb33",
Â  measurementId: "G-B9LLS9R4ZW"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
window.firebaseDB = db;
</script>

<style>
/* CSS à¦•à§‹à¦¡ à¦…à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¿à¦¤ à¦†à¦›à§‡ */
body{margin:0;background:linear-gradient(135deg,#74b9ff,#0984e3,#00b894);color:#fff;font-family:system-ui;text-align:center;height:100vh;overflow:hidden;position:relative;}
body.shake{animation:shake .4s}@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-10px)}75%{transform:translateX(10px)}}
h1{font-size:3em;margin:20px 0;text-shadow:0 0 20px #fff}
.timer{font-size:4em;font-weight:900;background:rgba(0,0,0,.3);padding:10px 30px;border-radius:25px;display:inline-block;text-shadow:0 0 20px #ffeb3b;}
.info{font-size:1.5em;margin:15px;background:rgba(255,255,255,.2);padding:15px;border-radius:20px;backdrop-filter:blur(10px);}
#area{position:relative;height:55vh;background:rgba(255,255,255,.15);border-radius:25px;overflow:hidden;margin:15px 10px;backdrop-filter:blur(15px);border:1px solid rgba(255,255,255,.3);}
.melon,.bomb,.ice{position:absolute;cursor:pointer;user-select:none;font-size:60px;filter:drop-shadow(0 0 8px rgba(255,255,255,0.8));animation:fall linear forwards;}
.ice{font-size:45px;filter:drop-shadow(0 0 10px rgba(135,206,255,1));}
@keyframes fall{from{top:-100px;transform:rotate(0)scale(.7)}50%{transform:rotate(360deg)scale(1)}to{top:100vh;transform:rotate(720deg)scale(1.05)}}
.boom{position:absolute;font-size:150px;pointer-events:none;animation:boom .7s forwards;z-index:99;}
@keyframes boom{0%{transform:scale(0) rotate(0);opacity:1}100%{transform:scale(5) rotate(180deg);opacity:0}}
.pop{font-size:45px;font-weight:bold;pointer-events:none;animation:p .6s forwards;position:absolute;z-index:100;}
.pop-melon{color:#00ff88;text-shadow:0 0 20px #00ff88}
.pop-bomb{color:#ff4757;text-shadow:0 0 20px #ff4757}
@keyframes p{0%{transform:scale(0)}60%{transform:scale(1.5)translateY(-40px)}100%{transform:translateY(-120px);opacity:0}}
button{margin:10px;padding:14px 36px;font-size:19px;background:rgba(255,255,255,0.95);color:#2d3436;border:none;border-radius:25px;font-weight:600;box-shadow:0 8px 25px rgba(0,0,0,0.3);transition:all 0.3s;}
button:hover{transform:translateY(-2px);box-shadow:0 12px 35px rgba(0,0,0,0.4);}
.paused{animation-play-state:paused!important;filter:brightness(0.8) saturate(0.9);}
#leaderboard{margin-top:15px;background:rgba(0,0,0,0.2);padding:12px;border-radius:18px;backdrop-filter:blur(10px);}
#topScores li{margin:4px 0;font-size:1.3em;}
#playButton{background:#00ff88;color:#2d3436;margin-bottom:12px;}
</style>
</head>
<body>

<h1>ğŸˆ Melon Clicker</h1>
<button id="playButton">â–¶ï¸ Play Game</button>
<div class="timer" id="timer">30</div>
<div class="info">
Â  Points: <span id="score">0</span> ğŸˆ | Total: <span id="total">0</span> ğŸˆ<br>
Â  Plays: <span id="plays">3</span>/3
</div>
<div id="area" style="display:none;"></div>

<!-- TON Wallet Connect Section -->
<div style="text-align:center; margin:30px 0; padding:20px; background:rgba(0,0,0,0.3); border-radius:15px;">
  <h2 style="color:#00ff9d; margin-bottom:15px;">Wallet & Rewards</h2>
  
  <button id="connectBtn" style="padding:16px 32px; font-size:18px; background:#0088cc; color:white; border:none; border-radius:12px; cursor:pointer; font-weight:bold;">
    Connect TON Wallet
  </button>
  
  <div id="status" style="margin:15px; color:#ff6b6b; font-weight:bold; font-size:17px;">
    Wallet not connected
  </div>
</div>

<div id="leaderboard">
Â  <h2>ğŸ† Top Scores</h2>
Â  <ul id="topScores"></ul>
</div>

<button onclick="mine()">â›ï¸ Daily Mine</button>
<button onclick="about()">â„¹ï¸ About</button>

<script type="module">
// import à¦®à¦¡à¦¿à¦‰à¦² à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¨: push à¦à¦° à¦¬à¦¦à¦²à§‡ set à¦¯à§à¦•à§à¦¤ à¦•à¦°à¦¾ à¦¹à§Ÿà§‡à¦›à§‡
const tg = window.Telegram?.WebApp || {HapticFeedback:{impactOccurred(){}},sendData(){},close(){location.reload();}};
tg.ready(); tg.expand();

import { getDatabase, ref, set, onValue, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";
const db = window.firebaseDB;

// Game variables
let timeLeft=30, score=0, total=parseInt(localStorage.getItem('totalScore')||'0'), plays=3;
let isFreezing=false, timerInt;
const today = new Date().toDateString();
if(localStorage.getItem('today')!==today){Â 
Â  localStorage.setItem('today',today);Â 
Â  localStorage.setItem('playsLeft',3);Â 
Â  localStorage.setItem('mined','no');Â 
Â  plays=3;Â 
} else plays = parseInt(localStorage.getItem('playsLeft')||'3');
document.getElementById('total').textContent=total;
document.getElementById('plays').textContent=plays;

// Leaderboard (à¦¸à¦‚à¦¶à§‹à¦§à¦¿à¦¤)
function updateLeaderboardFirebase(){
Â  // 'leaderboard' à¦ªà¦¾à¦¥à§‡ 'totalScore' à¦…à¦¨à§à¦¯à¦¾à¦¯à¦¼à§€ à¦…à¦°à§à¦¡à¦¾à¦° à¦•à¦°à§à¦¨
Â  const scoresRef = query(ref(db,'leaderboard'), orderByChild('totalScore'), limitToLast(100)); 
    
Â  onValue(scoresRef, snapshot=>{
Â  Â  const data = snapshot.val();
Â  Â  const list = document.getElementById('topScores');
Â  Â  list.innerHTML='';
Â  Â  if(data){
Â  Â  Â  // à¦¡à§‡à¦Ÿà¦¾à¦Ÿà¦¿à¦•à§‡ à¦‰à¦²à§à¦Ÿà§‹ à¦¦à¦¿à¦•à§‡ à¦¸à¦¾à¦œà¦¾à¦¨à§‹ à¦¹à¦šà§à¦›à§‡ à¦•à¦¾à¦°à¦£ orderByChild() à¦›à§‹à¦Ÿ à¦¥à§‡à¦•à§‡ à¦¬à§œ à¦•à¦°à§‡ à¦¸à¦¾à¦œà¦¾à§Ÿ
Â  Â  Â  const arr = Object.values(data).sort((a,b)=>b.totalScore-a.totalScore); 
Â  Â  Â  
Â  Â  Â  arr.forEach((p, index)=>{
Â  Â  Â  Â  const li=document.createElement('li');
Â  Â  Â  Â  // à¦°â€à§à¦¯à¦¾à¦™à§à¦• à¦à¦¬à¦‚ totalScore à¦¦à§‡à¦–à¦¾à¦šà§à¦›à§‡
Â  Â  Â  Â  li.textContent=`${index+1}. ${p.name}: ${p.totalScore} ğŸˆ`;
Â  Â  Â  Â  list.appendChild(li);
Â  Â  Â  });
Â  Â  }
Â  });
}
updateLeaderboardFirebase();

// Play Button (Plays 0 à¦¥à¦¾à¦•à¦²à§‡ à¦–à§‡à¦²à¦¾ à¦¶à§à¦°à§ à¦¹à¦“à§Ÿà¦¾ à¦†à¦Ÿà¦•à¦¾à¦¨à§‹ à¦¹à§Ÿà§‡à¦›à§‡)
document.getElementById('playButton').addEventListener('click', ()=>{
    if (plays <= 0) {
        alert("âŒ No plays left today! Please come back tomorrow.");
        return;
    }
    
Â  Â  document.getElementById('area').style.display='block';
Â  Â  document.getElementById('playButton').style.display='none';
Â  Â  startGame();
});

function startGame(){
Â  timeLeft=30; score=0; updateScore();
Â  timerInt=setInterval(()=>{
Â  Â  if(timeLeft>0){timeLeft--; document.getElementById('timer').textContent=timeLeft; if(timeLeft<=5) document.getElementById('timer').style.textShadow='0 0 20px #ff4757';}
Â  Â  else{clearInterval(timerInt); endSession();}
Â  },1000);
}

// Spawn objects
let activeObjects=[];
function spawnObject(type){
Â  if(activeObjects.length>=6) return;
Â  const el=document.createElement('div');
Â  el.textContent=type==='melon'?'ğŸˆ':type==='bomb'?'ğŸ’£':'â„ï¸';
Â  el.className=type==='melon'?'melon':type==='bomb'?'bomb':'ice';
Â  el.style.left=(Math.random()*82+8)+'%';
Â  el.style.animationDuration=(3+Math.random()*1.2)+'s';
Â  el.onclick=(e)=>{
Â  Â  const x=e.clientX||e.touches[0].clientX;
Â  Â  const y=e.clientY||e.touches[0].clientY;
Â  Â  if(type==='melon'){score+=10; tg.HapticFeedback.impactOccurred('light'); popText('+10 ğŸˆ',x,y,false);}
Â  Â  else if(type==='bomb'){score=Math.max(0,score-5); tg.HapticFeedback.impactOccurred('heavy'); document.body.classList.add('shake'); setTimeout(()=>document.body.classList.remove('shake'),400); bigBoom(x,y); popText('-5',x,y,true);}
Â  Â  else {triggerFreeze(); tg.HapticFeedback.impactOccurred('medium');}
Â  Â  updateScore(); el.remove(); activeObjects=activeObjects.filter(o=>o!==el);
Â  };
Â  document.getElementById('area').appendChild(el);
Â  activeObjects.push(el);
Â  setTimeout(()=>{ el.remove(); activeObjects=activeObjects.filter(o=>o!==el);},5500);
}

setInterval(()=>{
Â  if(timeLeft<=0||plays<=0||isFreezing) return;
Â  const count = timeLeft>15?2:1;
Â  for(let i=0;i<count;i++){
Â  Â  const r=Math.random();
Â  Â  if(r<0.78) spawnObject('melon');
Â  Â  else if(r<0.94) spawnObject('bomb');
Â  Â  else spawnObject('ice');
Â  }
},400);

// Freeze
function triggerFreeze(){
Â  if(isFreezing) return;
Â  isFreezing=true;
Â  activeObjects.forEach(el=>{ if(el.classList.contains('melon')||el.classList.contains('bomb')) el.classList.add('paused');});
Â  clearInterval(timerInt);
Â  setTimeout(()=>{
Â  Â  activeObjects.forEach(el=>{if(el.classList.contains('melon')||el.classList.contains('bomb')) el.classList.remove('paused');});
Â  Â  isFreezing=false;
Â  Â  timerInt=setInterval(()=>{
Â  Â  Â  if(timeLeft>0){timeLeft--; document.getElementById('timer').textContent=timeLeft; if(timeLeft<=5) document.getElementById('timer').style.textShadow='0 0 20px #ff4757';}
Â  Â  Â  else{clearInterval(timerInt); endSession();}
Â  Â  },1000);
Â  },2000);
}

// Helpers
function updateScore(){document.getElementById('score').textContent=score;}
function popText(text,x,y,isBomb){const p=document.createElement('div');p.textContent=text;p.className=`pop ${isBomb?'pop-bomb':'pop-melon'}`;p.style.left=(x-30)+'px';p.style.top=(y-70)+'px';document.body.appendChild(p);setTimeout(()=>p.remove(),600);}
function bigBoom(x,y){const b=document.createElement('div');b.textContent='ğŸ’¥';b.className='boom';b.style.left=(x-75)+'px';b.style.top=(y-75)+'px';document.body.appendChild(b);setTimeout(()=>b.remove(),700);}

// End session (à¦¸à¦‚à¦¶à§‹à¦§à¦¿à¦¤: Total Score à¦¸à§‡à¦­ à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡)
function endSession(){
Â  total+=score; localStorage.setItem('totalScore',total);
Â  plays--; localStorage.setItem('playsLeft',plays);
Â  document.getElementById('total').textContent=total; document.getElementById('plays').textContent=plays;
Â  tg.sendData(JSON.stringify({score,total}));
Â  
Â  // Total Score à¦¸à§‡à¦­ à¦•à¦°à¦¾à¦° à¦¨à¦¤à§à¦¨ à¦²à¦œà¦¿à¦•:
Â  const userId = (tg.initDataUnsafe && tg.initDataUnsafe.user && tg.initDataUnsafe.user.id) ? tg.initDataUnsafe.user.id : 'AnonUser';
Â  const userName = (tg.initDataUnsafe && tg.initDataUnsafe.user && tg.initDataUnsafe.user.username) ? tg.initDataUnsafe.user.username : `User-${userId}`;
Â  
Â  const userRef = ref(db, `leaderboard/${userId}`);
Â  
Â  set(userRef, {
Â  Â  name: userName,
Â  Â  totalScore: total, // <--- à¦à¦–à¦¾à¦¨à§‡ 'total' à¦¸à§à¦•à§‹à¦° à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡
Â  Â  timestamp: Date.now()
Â  });
  // à¦ªà§‚à¦°à§à¦¬à§‡à¦° push(ref(db,'scores'),...) à¦«à¦¾à¦‚à¦¶à¦¨à¦Ÿà¦¿ à¦¬à¦¾à¦¦ à¦¦à§‡à¦“à¦¯à¦¼à¦¾ à¦¹à¦¯à¦¼à§‡à¦›à§‡à¥¤

Â  if(plays>0){alert(`â° Time Up!\nRound: +${score} ğŸˆ\nTotal: ${total} ğŸˆ\nPlays left: ${plays}`); location.reload();}
Â  else{document.getElementById('area').innerHTML=`<h2 style="margin-top:140px;font-size:2em;">ğŸ‰ All 3 plays done!<br>Total: ${total} ğŸˆ<br>Come back tomorrow!</h2>`; document.getElementById('timer').textContent='DONE'; alert(`ğŸ‰ All done!\nLast round: ${score} ğŸˆ\nTotal: ${total} ğŸˆ\nTomorrow again!`); setTimeout(()=>tg.close(),5000);}
}

// Daily Mine
function mine(){if(localStorage.getItem('mined')===today) return alert('â›ï¸ Already mined today!');
const reward=Math.floor(Math.random()*600)+300; total+=reward; localStorage.setItem('totalScore',total); localStorage.setItem('mined',today);
document.getElementById('total').textContent=total; alert(`â›ï¸ Mined +${reward} ğŸˆ!\nTotal now: ${total} ğŸˆ`);}

// About
function about(){alert("ğŸˆ Melon Clicker PRO\nğŸ’£ Boom click = -5\nğŸˆ Melon click = +10\nâ„ï¸ Ice click = 2s FREEZE\n~300 fruits/30s | 3 plays/day\nTelegram Mini Game Ready!");}

<script type="module">
  // Telegram WebApp ready
  Telegram.WebApp.ready();
  Telegram.WebApp.expand();

  // TON Connect UI (à¦à¦‡ à¦²à¦¾à¦‡à¦¨à¦Ÿà¦¾ à¦ à¦¿à¦• à¦°à¦¾à¦–à§‹)
  import { TonConnectUI } from 'https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js?module';

  const tonConnectUI = new TonConnectUI({
    manifestUrl: 'https://raw.githubusercontent.com/alifahmedkhanxyz/melon-clicker/main/tonconnect-manifest.json'
  });

  // à¦¬à¦¾à¦Ÿà¦¨ à¦†à¦° à¦¸à§à¦Ÿà§à¦¯à¦¾à¦Ÿà¦¾à¦¸ à¦§à¦°à¦¾
  const connectBtn = document.getElementById('connectBtn');
  const statusDiv = document.getElementById('status');

  // à¦¸à§à¦Ÿà§à¦¯à¦¾à¦Ÿà¦¾à¦¸ à¦†à¦ªà¦¡à§‡à¦Ÿ
  async function updateStatus() {
    if (await tonConnectUI.connected) {
      const addr = tonConnectUI.account.address;
      const short = addr.slice(0, 6) + "..." + addr.slice(-4);
      statusDiv.innerHTML = `Connected: <span style="color:#00ff9d;">${short}</span>`;
      connectBtn.style.display = "none";
    } else {
      statusDiv.innerHTML = "Wallet not connected";
      connectBtn.style.display = "block";
    }
  }

  // à¦•à¦¾à¦¨à§‡à¦•à§à¦Ÿ à¦¬à¦¾à¦Ÿà¦¨ à¦•à§à¦²à¦¿à¦•
  connectBtn.onclick = () => tonConnectUI.openModal();

  // à¦ªà§à¦°à¦¥à¦®à§‡ à¦šà§‡à¦• + à¦ªà¦°à¦¿à¦¬à¦°à§à¦¤à¦¨ à¦¹à¦²à§‡ à¦†à¦ªà¦¡à§‡à¦Ÿ
  updateStatus();
  tonConnectUI.onStatusChange(updateStatus);
</script>


</script>
</body>

</html>

